
CREATE VIEW KARP.Список_небесных_тел as
  SELECT (н.наименование || '-' || н.класс) вид, count(п.ид_планеты) известно, н.характеристика
    FROM KARP.Виды_небесных_тел н
      full outer join KARP.Планеты п on п.ид_вида = н.ид_вида
    GROUP BY н.наименование, н.класс, н.характеристика, н.ид_вида
    ORDER BY н.ид_вида;

CREATE VIEW KARP.Выгодные_предложения as
  SELECT б.ид_ресурса, б.название_ресурса, nvl(max(т.стоимость_покупки), -1) макс_стоимость,
      count(т.ид_предложения) всего_предложений
    FROM KARP.База_ресурсов б
      left outer join KARP.Торговые_предложения т on б.ид_ресурса = т.ид_ресурса
    GROUP BY б.ид_ресурса, б.название_ресурса
    ORDER BY б.ид_ресурса;

CREATE VIEW KARP.Сделки as
  SELECT з.ид_сделки, б.название_ресурса Предмет_сделки, к.имя_корабля Корабль_перевозчик,
    с.торговая_станция Покупающая_станция, п.ид_поселения Продающее_поселение,
    з.количество, з.стоимость
    FROM KARP.Записи_сделок з
      inner join KARP.Добывающие_поселения п on з.ид_продающего_поселения  = п.ид_поселения
      inner join KARP.Торговые_станции с on з.ид_покупающей_станции  = с.ид_станции
      inner join KARP.Корабли_перевозчики к on з.ид_корабля_перевозчика  = к.ид_корабля
      inner join KARP.База_ресурсов б on з.ид_ресурса  = б.ид_ресурса;
      
CREATE VIEW KARP.Системы_планет as
  SELECT с.ид_системы, с.название, count(п.ид_планеты) Число_планет
    FROM KARP.Планетные_системы с
      inner join KARP.Планеты п on с.ид_системы = п.ид_системы
    GROUP BY с.ид_системы, с.название
    ORDER BY с.ид_системы;

CREATE VIEW KARP.Список_планет as
  SELECT п.ид_планеты, п.имя, с.название, (в.наименование || '-' || в.класс) вид, г.название_государства
    FROM KARP.Планеты п
      inner join KARP.Планетные_системы с on п.ид_системы = с.ид_системы
      inner join KARP.Виды_небесных_тел в on п.ид_вида = в.ид_вида
      inner join KARP.Государства г on п.ид_государства = г.ид_государства
    ORDER BY п.ид_планеты;
    
CREATE VIEW KARP.Список_государств as
  SELECT ид_государства, название_государства, процветание уровень_процветания,
      режим, раса, правитель FROM KARP.Государства;
    
CREATE VIEW KARP.Отношение_государств as
  SELECT г1.название_государства "ГОСУДАРСТВО 1", г2.название_государства "ГОСУДАРСТВО 2", п.отношения
    FROM KARP.Политика п 
      inner join KARP.Государства г1 on п.ид_государства1 = г1.ид_государства
      inner join KARP.Государства г2 on п.ид_государства2 = г2.ид_государства;

CREATE VIEW KARP.Разработка_месторождений as
  SELECT  м.ид_месторождения, б.название_ресурса, м.потенциальный_запас, NVL(sum(д.наличие), 0) не_продано, NVL(sum(с.количество), 0) продано,
      round(100 * ((NVL(sum(д.наличие), 0) + NVL(sum(с.количество), 0)) / м.потенциальный_запас)) "ОСВОЕНИЕ_МЕСТОРОЖДЕНИЯ, %"
    FROM KARP.Месторождения_ресурсов м
      inner join KARP.База_ресурсов б on м.ид_ресурса = б.ид_ресурса
      full outer join KARP.Добыча_ресурсов д on м.ид_месторождения = д.ид_месторождения
      full outer join KARP.Записи_сделок с on д.ид_поселения = с.ид_продающего_поселения and м.ид_ресурса = с.ид_ресурса
    GROUP BY м.ид_месторождения, б.название_ресурса, м.потенциальный_запас
    ORDER BY м.ид_месторождения;

CREATE VIEW KARP.Ресурсы_на_планетах as
  SELECT п.имя, п.население, б.название_ресурса, п.изображение
    FROM KARP.База_ресурсов б
      inner join KARP.Месторождения_ресурсов м on б.ид_ресурса = м.ид_ресурса
      inner join KARP.Планеты п on м.ид_планеты = п.ид_планеты
    ORDER BY п.ид_планеты;
    
CREATE VIEW KARP.Список_станций as
  SELECT п.имя, г.название_государства, с.торговая_станция, с.состояние_станции
    FROM KARP.Торговые_станции с
      inner join KARP.Планеты п on с.ид_планеты = п.ид_планеты
      inner join KARP.Государства г on п.ид_государства = г.ид_государства
    ORDER BY с.ид_станции;

CREATE VIEW KARP.Список_кораблей as
  SELECT к.ид_корабля ид, к.имя_корабля название, к.ид_класса_корабля класс, 
      в.коэффициент_мощности, к.баланс, к.состояние_корабля состояние,
      к.размер_экипажа, к.дополнительная_информация сведения
    FROM KARP.Корабли_перевозчики к
        inner join KARP.Виды_кораблей в on к.ид_класса_корабля = в.ид_класса_корабля;

CREATE VIEW KARP.История_перевозок as
  SELECT к.имя_корабля, к.баланс, с.ид_продающего_поселения поселение,
      с.ид_покупающей_станции станция, б.название_ресурса, с.количество, с.стоимость
    FROM KARP.Корабли_перевозчики к
      inner join KARP.Записи_сделок с on к.ид_корабля = с.ид_корабля_перевозчика
      inner join KARP.База_ресурсов б on с.ид_ресурса = б.ид_ресурса
    ORDER BY к.ид_корабля; 
